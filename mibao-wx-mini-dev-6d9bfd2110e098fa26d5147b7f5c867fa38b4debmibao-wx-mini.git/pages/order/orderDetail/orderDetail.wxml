<import src="/templates/orderProduct/index.wxml"/>
<wxs module="filters" src="../../../wxs/filter.wxs"></wxs>
<view class="orderDetail-wp">
    <view class="header-bg">
    </view>
    <scroll-view class="orderDetail" style="height: 100%;" scroll-y="{{scrollY}}">
        <view class="header-wp">
            <view class="header">
                <view class="orderStatus">
                    <!--等待-->
                    <block wx:if="{{orderInfo.state=='pending_system_credit_check'||orderInfo.state=='pending_jimi_credit_check'||orderInfo.state=='pending_artificial_credit_check'||orderInfo.state=='pending_pay'||orderInfo.state=='pending_send_goods'||orderInfo.state=='pending_return'||orderInfo.state=='pending_running'}}">
                        <text class="iconfont icon-dengdai"></text>
                    </block>
                    <!--感叹号-->
                    <block wx:if="{{orderInfo.state=='running_overdue' || orderInfo.state=='return_overdue' || orderInfo.state=='pending_user_compensate'}}">
                        <text class="iconfont icon-ico-bangzhu1"></text>
                    </block>
                    <!--租赁中 ...-->
                    <block wx:if="{{orderInfo.state=='running'}}">
                        <text class="iconfont icon-gengduo"></text>
                    </block>
                    <!--打钩...-->
                    <block wx:if="{{orderInfo.state=='pending_receive_goods'||orderInfo.state=='lease_finished'}}">
                        <text class="iconfont icon-check-circle"></text>
                    </block>
                    <!--叉差 审核不通过-->
                    <block wx:if="{{orderInfo.state=='user_canceled'||orderInfo.state=='system_credit_check_unpass_canceled'||orderInfo.state=='artificial_credit_check_unpass_canceled' ||orderInfo.state=='merchant_relet_check_unpass_canceled'||orderInfo.state=='merchant_not_yet_send_canceled'||orderInfo.state=='order_payment_overtime_canceled'||orderInfo.state=='express_rejection_canceled'}}">
                        <text class="iconfont icon-cuowu"></text>
                    </block>
                    {{orderInfo.stateStr}}
                </view>
                <view class="statusDes">
                    {{orderInfo.description}}
                </view>
            </view>
        </view>
        <view class="content-wp">
            <!--物流信息-->
            <block wx:if="{{(orderInfo.state=='pending_receive_goods'||orderInfo.state=='returning') && logisticsMsg.info.length}}">
                <view class="express-wp" catchtap="toOrderExpress">
                    <view class="rows">
                        <view class="t">
                            <view class="min">{{logisticsMsg.info[0].ftime2}}</view>
                            <view class="day">{{logisticsMsg.info[0].ftime1}}</view>
                        </view>
                        <view class="dot current">
                        </view>
                        <view class="cont">{{logisticsMsg.info[0].context}}</view>
                    </view>
                </view>
            </block>
            <view class="rents-wp">
                <!--应付款总额-->
                <!--待审核 待支付 -->
                <block wx:if="{{orderInfo.state=='pending_system_credit_check' || orderInfo.state=='pending_jimi_credit_check' || orderInfo.state=='pending_artificial_credit_check'|| orderInfo.state=='pending_pay'}}">
                    <view class="rent-wp">
                        <view class="title {{!showDetailTop?'':'hide'}}">
                            <view class="left">
                                <block wx:if="{{orderInfo.state=='pending_pay'}}">
                                    {{orderInfo.longLease?'本期':''}}应付款总额
                                </block>
                                <block wx:else>
                                    {{orderInfo.longLease?'首期':''}}应付款总额
                                </block>

                            </view>
                            <view class="right">
                                <text class="danwei">￥</text>
                                <text class="money">{{filters.parsePrice(orderLeaseInfo.currentPeriodTotalAmount)}}
                                </text>
                            </view>
                        </view>
                        <view class="setAnimation {{!showDetailTop?'':'hide'}}">
                            <view class="rentItems">
                                <block wx:if="{{orderInfo.state=='pending_pay'}}">
                                    <view class="item" wx:if="{{orderInfo.state=='pending_pay'}}">
                                        <view class="left">
                                            {{orderInfo.longLease?'本期':''}}租赁天数
                                        </view>
                                        <view class="right">
                                            <text class="money">{{orderLeaseInfo.currentPeriodLeaseTerm}}</text>
                                            <text class="danwei">天</text>
                                        </view>
                                    </view>
                                </block>
                                <block wx:else>
                                    <view class="item">
                                        <view class="left">
                                            租赁天数
                                        </view>
                                        <view class="right">
                                            <text class="money">{{orderLeaseInfo.leaseTerm}}</text>
                                            <text class="danwei">天</text>
                                            <block wx:if="{{orderInfo.leaseDay>30}}">
                                                <text class="danwei">/共</text>
                                                <text class="money">{{orderLeaseInfo.payNum}}</text>
                                                <text class="danwei">期</text>
                                            </block>
                                        </view>
                                    </view>
                                </block>
                                <!--显示商品租金-->
                                <view class="item">
                                    <view class="left">
                                        每日租金
                                    </view>
                                    <view class="right">
                                        <text class="money">{{filters.parsePrice(orderLeaseInfo.dailyRent)}}</text>
                                        <text class="danwei">元/天</text>
                                    </view>
                                </view>
                                <view class="item">
                                    <view class="left">
                                        租赁保障
                                        <text class="beizhu">(只须首期支付)</text>
                                    </view>
                                    <view class="right">
                                        <text class="money">{{filters.parsePrice(orderInfo.accidentInsurance)}}</text>
                                        <text class="danwei">元</text>
                                    </view>
                                </view>
                                <view class="item" wx:if="{{orderLeaseInfo.voucherDiscount!=0}}">
                                    <view class="left">
                                        优惠礼券
                                    </view>
                                    <view class="right">
                                        <text class="coupon">-￥{{filters.parsePrice(orderLeaseInfo.voucherDiscount)}}
                                        </text>
                                    </view>
                                </view>
                            </view>
                            <!--礼券选择 下单时候没选择礼券 支付的时候可以继续选择 押金支付在确认页选择优惠券-->
                            <block wx:if="{{orderLeaseInfo.deposit==0 && orderLeaseInfo.voucherDiscount==0 && orderInfo.state=='pending_pay'}}">
                                <view class="couponChoose" catchtap="couponChoose">
                                    <view class="left">
                                        优惠礼券
                                    </view>
                                    <view class="right">
                                        <block wx:if="{{useCoupon && choosedCouponPrice!=0}}">
                                            优惠券：省
                                            <text class="couponNum">{{choosedCouponPrice}}</text>
                                            元
                                        </block>
                                        <block wx:else>
                                            <block wx:if="{{!couponList.length}}">
                                                无可用优惠券
                                            </block>
                                            <block wx:else>
                                                有
                                                <text class="couponNum">{{couponList.length}}</text>
                                                张可用优惠券
                                            </block>

                                        </block>
                                        <text class="iconfont icon-ico_back-copy"></text>
                                    </view>
                                </view>
                            </block>

                            <!--有则显示 租赁中之前叫分期详情-->

                            <view class="instalmentInfo" catchtap="toInstalmentInfo" wx:if="{{orderInfo.instalment}}">
                                <view class="left">
                                    分期详情
                                </view>
                                <view class="right">
                                    <text class="money">{{orderLeaseInfo.leaseTerm}}</text>
                                    <text class="danwei">天</text>
                                    <text class="danwei">/共</text>
                                    <text class="qishu money">{{orderLeaseInfo.payNum}}</text>
                                    <text class="danwei">期</text>
                                    <text class="iconfont icon-ico_back-copy"></text>
                                </view>
                            </view>
                        </view>
                        <view class="footer" catchtap="zhanKaiTop">{{!showDetailTop?'收起详情':'展开详情'}}
                            <text class="iconfont {{showDetailTop?'icon-ico_back-copy1':'icon-ico_right-copy'}}"></text>
                        </view>
                    </view>
                </block>

                <!--实付款-->
                <!--待收货 待发货 短期租赁中-->
                <block wx:if="{{orderInfo.state=='pending_send_goods' ||orderInfo.state=='pending_receive_goods' ||(orderInfo.state=='running' && !orderInfo.longLease)}}">
                    <view class="rent-wp">
                        <view class="title {{!showDetailTop?'':'hide'}}">
                            <view class="left">
                                {{orderInfo.longLease?'首期':''}}实付款总额
                            </view>
                            <view class="right">
                                <text class="danwei">￥</text>
                                <text class="money">{{filters.parsePrice(orderInfo.firstActualPayAmount)}}</text>
                            </view>
                        </view>
                        <view class="setAnimation {{!showDetailTop?'':'hide'}}">
                            <view class="rentItems">
                                <!--长租显示-->
                                <block wx:if="{{orderInfo.longLease}}">
                                    <view class="item">
                                        <view class="left">
                                            当前租期
                                        </view>
                                        <view class="right">
                                            <view class="money">
                                                {{orderLeaseInfo.currentPeriod>10?orderLeaseInfo.currentPeriod:'0'+orderLeaseInfo.currentPeriod}}
                                            </view>
                                            <view class="danwei">/</view>
                                            <view class="money">{{orderLeaseInfo.payNum}}</view>
                                            <view class="danwei">期</view>
                                        </view>
                                    </view>
                                    <view class="item">
                                        <view class="left">
                                            本期租赁天数
                                        </view>
                                        <view class="right">
                                            <text class="money">{{orderLeaseInfo.currentPeriodLeaseTerm}}</text>
                                            <text class="danwei">天</text>
                                        </view>
                                    </view>
                                </block>
                                <block wx:else>
                                    <view class="item">
                                        <view class="left">
                                            租赁天数
                                        </view>
                                        <view class="right">
                                            <text class="money">{{orderLeaseInfo.leaseTerm}}</text>
                                            <text class="danwei">天</text>
                                            <block wx:if="{{orderInfo.leaseDay>30}}">
                                                <text class="danwei">/共</text>
                                                <text class="money">{{orderLeaseInfo.payNum}}</text>
                                                <text class="danwei">期</text>
                                            </block>
                                        </view>
                                    </view>
                                </block>
                                <view class="item">
                                    <view class="left">
                                        每日租金
                                    </view>
                                    <view class="right">
                                        <text class="money">{{filters.parsePrice(orderLeaseInfo.dailyRent)}}</text>
                                        <text class="danwei">元/天</text>
                                    </view>
                                </view>
                                <view class="item">
                                    <view class="left">
                                        租赁保障
                                        <text class="beizhu">(只须首期支付)</text>
                                    </view>
                                    <view class="right">
                                        <text class="money">{{filters.parsePrice(orderInfo.accidentInsurance)}}</text>
                                        <text class="danwei">元</text>
                                    </view>
                                </view>
                                <!--<view class="item">-->
                                <!--<view class="left">-->
                                <!--配送方式-->
                                <!--</view>-->
                                <!--<view class="right">-->
                                <!--<text class="blue">单程包邮</text>-->
                                <!--</view>-->
                                <!--</view>-->
                                <view class="item" wx:if="{{orderLeaseInfo.voucherDiscount!=0}}">
                                    <view class="left">
                                        优惠礼券
                                    </view>
                                    <view class="right">
                                        <text class="coupon">-￥{{filters.parsePrice(orderLeaseInfo.voucherDiscount)}}
                                        </text>
                                    </view>
                                </view>
                            </view>
                            <!--有则显示 租赁中之前叫分期详情-->
                            <view class="instalmentInfo" catchtap="toInstalmentInfo" wx:if="{{orderInfo.instalment}}">
                                <view class="left">
                                    分期详情
                                </view>
                                <view class="right">
                                    <text class="money">{{orderLeaseInfo.leaseTerm}}</text>
                                    <text class="danwei">天</text>
                                    <text class="danwei">/共</text>
                                    <text class="qishu money">{{orderLeaseInfo.payNum}}</text>
                                    <text class="danwei">期</text>
                                    <text class="iconfont icon-ico_back-copy"></text>
                                </view>
                            </view>
                        </view>
                        <view class="footer" catchtap="zhanKaiTop">{{!showDetailTop?'收起详情':'展开详情'}}
                            <text class="iconfont {{showDetailTop?'icon-ico_back-copy1':'icon-ico_right-copy'}}"></text>
                        </view>
                    </view>
                </block>

                <!--长期 租赁中 不用考虑优惠礼券选择好了的问题-->
                <block wx:if="{{orderInfo.state=='running'&& orderInfo.longLease}}">
                    <view class="rent-wp">
                        <!--当期已付清-->
                        <block wx:if="{{orderLeaseInfo.currentPeriodPaid}}">
                            <view class="rentPayed">
                                <view class="img">
                                    <image src="../../../images/order/good@2x.png"></image>
                                </view>
                                <block wx:if="{{orderLeaseInfo.lastPayTime}}">
                                    <view class="line1">本期租金已付清</view>
                                    <view class="xiaqi">
                                        下期支付日期：{{filters.parseTime(orderLeaseInfo.lastPayTime,'y-m-d')}}
                                    </view>
                                </block>
                                <block wx:else>
                                    <view class="line1">所有租金已付清</view>
                                </block>

                            </view>
                            <view class="setAnimation">
                                <view class="instalmentInfo" catchtap="toInstalmentInfo"
                                      wx:if="{{orderInfo.instalment}}">
                                    <view class="left">
                                        查看分期账单
                                    </view>
                                    <view class="right">
                                        <text class="iconfont icon-ico_back-copy"></text>
                                    </view>
                                </view>
                            </view>
                        </block>

                        <block wx:else>
                            <view class="title">
                                <view class="left">
                                    本期应付款总额
                                </view>
                                <view class="right">
                                    <text class="danwei">￥</text>
                                    <text class="money">{{filters.parsePrice(orderLeaseInfo.currentPeriodTotalAmount)}}
                                    </text>
                                </view>
                            </view>
                            <view class="setAnimation">
                                <view class="rentItems">
                                    <!--长租显示-->
                                    <view class="item">
                                        <view class="left">
                                            当前租期
                                        </view>
                                        <view class="right">
                                            <view class="money">
                                                {{orderInfo.nextPayNum>10?orderInfo.nextPayNum:'0'+orderInfo.nextPayNum}}
                                            </view>
                                            <view class="danwei">/</view>
                                            <view class="money">{{orderLeaseInfo.payNum}}</view>
                                            <view class="danwei">期</view>
                                        </view>
                                    </view>
                                    <view class="item">
                                        <view class="left">
                                            本期租赁天数
                                        </view>
                                        <view class="right">
                                            <text class="money">{{orderLeaseInfo.currentPeriodLeaseTerm}}</text>
                                            <text class="danwei">天</text>
                                        </view>
                                    </view>
                                    <view class="item">
                                        <view class="left">每日租金
                                        </view>
                                        <view class="right">
                                            <text class="money">{{filters.parsePrice(orderLeaseInfo.dailyRent)}}</text>
                                            <text class="danwei">元/天</text>
                                        </view>
                                    </view>
                                </view>
                                <!--礼券选择  账期中暂时不能使用优惠券-->
                                <!--<view class="couponChoose" catchtap="couponChoose" >-->
                                <!--<view class="left">-->
                                <!--优惠礼券-->
                                <!--</view>-->
                                <!--<view class="right">-->
                                <!--<block wx:if="{{useCoupon && choosedCouponPrice!=0}}">-->
                                <!--优惠券：省-->
                                <!--<text class="couponNum">{{choosedCouponPrice}}</text>-->
                                <!--元-->
                                <!--</block>-->
                                <!--<block wx:else>-->
                                <!--<block wx:if="{{!couponList.length}}">-->
                                <!--无可用优惠券-->
                                <!--</block>-->
                                <!--<block wx:else>-->
                                <!--有-->
                                <!--<text class="couponNum">{{couponList.length}}</text>-->
                                <!--张可用优惠券-->
                                <!--</block>-->

                                <!--</block>-->
                                <!--<text class="iconfont icon-ico_back-copy"></text>-->
                                <!--</view>-->
                                <!--</view>-->
                                <view class="instalmentInfo" catchtap="toInstalmentInfo"
                                      wx:if="{{orderInfo.instalment}}">
                                    <view class="left">
                                        查看分期账单
                                    </view>
                                    <view class="right">
                                        <text class="iconfont icon-ico_back-copy"></text>
                                    </view>
                                </view>
                            </view>
                        </block>

                    </view>
                </block>

                <!--待还逾期 "-->
                <block wx:if="{{orderInfo.state=='return_overdue'}}">
                    <view class="rent-wp">
                        <view class="title">
                            <view class="left">
                                退还逾期
                            </view>
                            <view class="right">
                                <text class="danwei">￥</text>
                                <text class="money">{{filters.parsePrice(orderInfo.delayAmount)}}</text>
                            </view>
                        </view>
                        <view class="setAnimation">

                            <view class="rentItems">
                                <view class="item">
                                    <view class="left">
                                        逾期天数
                                    </view>
                                    <view class="right">
                                        <text class="money">{{orderInfo.delayDay}}</text>
                                        <text class="danwei">天</text>
                                    </view>
                                </view>
                                <view class="item">
                                    <view class="left">
                                        逾期金额
                                    </view>
                                    <view class="right">
                                        <text class="money yuqi">200.99</text>
                                        <text class="danwei">元/天</text>
                                    </view>
                                </view>
                            </view>
                        </view>
                    </view>
                </block>

                <!--待赔偿/申诉 orderCompensateInfo  有两个状态  前面那个是商户发起赔偿后  后一个是用户拒绝赔偿后 -->
                <block wx:if="{{orderInfo.state=='pending_user_compensate'||orderInfo.state=='pending_compensate_check'}}">
                    <view class="rent-wp">
                        <view class="title">
                            <view class="left">
                                赔偿应付款总额
                            </view>
                            <view class="right">
                                <text class="danwei">￥</text>
                                <text class="money">{{filters.parsePrice(orderCompensateInfo.compensateAmount)}}</text>
                            </view>
                        </view>
                        <view class="setAnimation">
                            <view class="rentItems">
                                <view class="item">
                                    <view class="left">
                                        赔偿金额
                                    </view>
                                    <view class="right">
                                        <text class="money">{{filters.parsePrice(orderCompensateInfo.compensateAmount)}}
                                        </text>
                                        <text class="danwei">元</text>
                                    </view>
                                </view>
                                <view class="item">
                                    <view class="left">
                                        发起时间
                                    </view>
                                    <view class="right">
                                        <text class="time">{{filters.parseTime(orderCompensateInfo.createTime)}}</text>
                                    </view>
                                </view>
                                <view class="item">
                                    <view class="left">
                                        赔偿详情
                                    </view>
                                    <view class="right" catchtap="compensateDetail">
                                        <text class="blue">查看详情</text>
                                    </view>
                                </view>
                            </view>
                            <!--赔偿进度-->
                            <block wx:if="{{orderCompensateInfo.checkState!=='init'}}">
                                <view class="saveschedule" catchtap="saveSchedule">
                                    <view class="left">
                                        查看赔偿进度
                                    </view>
                                    <view class="right">
                                        <text class="iconfont icon-ico_back-copy"></text>
                                    </view>
                                </view>
                            </block>
                            <block wx:else>
                                <view class="footer compensate" catchtap="toSaveGuard">
                                    <text class="iconfont icon-process04"></text>
                                    对赔偿金额有异议
                                </view>

                            </block>
                        </view>
                    </view>
                </block>

                <!--租赁中含 以后的状态显示订单总额-->
                <block wx:if="{{orderInfo.state!=='pending_compensate_check' && orderInfo.state!=='pending_system_credit_check' && orderInfo.state!=='pending_jimi_credit_check' && orderInfo.state!=='pending_artificial_credit_check' && orderInfo.state!=='pending_pay' && orderInfo.state!=='pending_send_goods' && orderInfo.state!=='pending_receive_goods' && orderInfo.state!=='pending_user_compensate'}}">
                    <view class="rent-wp">
                        <view class="title {{showDetailBottom?'':'hide'}}">
                            <view class="left">
                                订单总额
                            </view>
                            <view class="right">
                                <text class="danwei">￥</text>
                                <text class="money">{{filters.parsePrice(orderLeaseInfo.totalAmount)}}</text>
                            </view>
                        </view>

                        <view class="setAnimation {{showDetailBottom?'':'hide'}}">
                            <view class="rentItems">
                                <view class="item">
                                    <view class="left">
                                        租赁天数
                                    </view>
                                    <view class="right">
                                        <text class="money">{{orderLeaseInfo.leaseTerm}}</text>
                                        <text class="danwei">天</text>
                                        <block wx:if="{{orderInfo.leaseDay>30}}">
                                            <text class="danwei">/共</text>
                                            <text class="money">{{orderLeaseInfo.payNum}}</text>
                                            <text class="danwei">期</text>
                                        </block>
                                    </view>
                                </view>
                                <view class="item">
                                    <view class="left">每日租金
                                    </view>
                                    <view class="right">
                                        <text class="money">{{filters.parsePrice(orderLeaseInfo.dailyRent)}}</text>
                                        <text class="danwei">元/天</text>
                                    </view>
                                </view>
                                <view class="item">
                                    <view class="left">
                                        租赁保障
                                        <text class="beizhu">(只须首期支付)</text>
                                    </view>
                                    <view class="right">
                                        <text class="money">{{filters.parsePrice(orderInfo.accidentInsurance)}}</text>
                                        <text class="danwei">元</text>
                                    </view>
                                </view>
                                <view class="item" wx:if="{{orderInfo.totalVoucherDiscount}}">
                                    <view class="left">
                                        优惠礼券
                                    </view>
                                    <view class="right">
                                        <text class="coupon">-￥{{filters.parsePrice(orderInfo.totalVoucherDiscount)}}
                                        </text>
                                    </view>
                                </view>
                            </view>

                            <!--有则显示 租赁中之前叫分期详情   长期租赁中 不显示-->
                            <view class="instalmentInfo" catchtap="toInstalmentInfo" wx:if="{{orderInfo.instalment}}">
                                <view class="left">
                                    查看分期账单
                                </view>
                                <view class="right">
                                    <text class="iconfont icon-ico_back-copy"></text>
                                </view>
                            </view>
                        </view>

                        <!--展开-->
                        <view class="footer" catchtap="zhanKaiBottom">{{showDetailBottom?'收起详情':'展开详情'}}
                            <text class="iconfont {{showDetailBottom?'icon-ico_right-copy':'icon-ico_back-copy1'}}"></text>
                        </view>
                    </view>
                </block>


            </view>

            <view class="merchant">
                <view class="name" catchtap="toStoreDetail">
                    {{orderInfo.orderMerchantInfoBean.merchantName}}
                </view>
                <view class="contact" catchtap="callphone">
                    <image src="../../../images/order/ico-contact@2x.png"></image>
                </view>
            </view>

            <!--利用模板传递数据 多个商品租赁显示右方有租赁数字的-->
            <view class="order-product-wp" catchtap="toGoodsDetail">
                <template is="orderProduct-num" data="{{...goodsInfo}}"/>
            </view>

            <!--订单用户备注-->
            <view class="userRemark">
                <view class="left">
                    订单备注:
                </view>
                <view class="right">
                    {{orderInfo.remark}}
                </view>
            </view>

            <!--订单操作-->
            <view class="actions">

                <block wx:if="{{orderInfo.state=='pending_system_credit_check' || orderInfo.state=='pending_jimi_credit_check' || orderInfo.state=='pending_artificial_credit_check' || orderInfo.state=='pending_pay'}}">
                    <button class="secondBtn btn" catchtap="cancelOrder">
                        取消订单
                    </button>
                </block>

                <block wx:if="{{orderInfo.quickLease}}">
                    <button class="mainBtn btn" catchtap="showDepositModal">
                        押金支付
                    </button>
                </block>

                <block wx:if="{{orderInfo.state=='pending_send_goods'&& orderInfo.reminded}}">
                    <button class="secondBtn btn" catchtap="urgeExpress">催促发货</button>
                </block>

                <block wx:if="{{orderInfo.state=='pending_receive_goods'}}">
                    <button class="secondBlueBtn btn" catchtap="receiveGood">确认收货</button>

                </block>

                <!--已取消的和租赁中之前都没有这些-->
                <block wx:if="{{orderInfo.state!=='pending_system_credit_check' && orderInfo.state!=='pending_jimi_credit_check' && orderInfo.state!=='pending_artificial_credit_check' && orderInfo.state!=='pending_pay' && orderInfo.state!=='pending_send_goods' && orderInfo.state!=='pending_receive_goods' && orderInfo.state!=='user_canceled'&& orderInfo.state!=='system_credit_check_unpass_canceled'&&orderInfo.state!=='artificial_credit_check_unpass_canceled' &&orderInfo.state!=='merchant_relet_check_unpass_canceled'&&orderInfo.state!=='merchant_not_yet_send_canceled' && orderInfo.state!=='order_payment_overtime_canceled' && orderInfo.state!=='express_rejection_canceled'&& orderInfo.state!=='pending_running'}}">
                    <button class="secondBtn btn" catchtap="toComment">
                        {{orderLeaseInfo.commented?'查看评价':'立即评价'}}
                    </button>
                    <button class="secondBtn btn" catchtap="toReturn" wx:if="{{orderInfo.paid && orderInfo.state=='running'}}">
                        提前归还
                    </button>
                </block>

                <!--立即归还-->
                <block wx:if="{{orderInfo.state=='pending_return'|| orderInfo.state=='return_overdue'}}">
                    <button class="secondBtn btn" catchtap="toReturn">
                        立即归还
                    </button>
                </block>

                <!--<button class="secondBtn btn">申请售后</button>-->
            </view>
            <!--订单编号 时间 -->
            <view class="orderInfo">
                <view class="item orderNumber">
                    <view class="left">
                        订单编号:
                    </view>
                    <view class="right">
                        {{orderLeaseInfo.orderNumber}}
                        <view class="copy" catchtap="copy">
                            复制
                        </view>
                    </view>
                </view>
                <view class="item">
                    <view class="left">
                        下单时间:
                    </view>
                    <view class="right">
                        {{filters.parseTime(orderLeaseInfo.createTime)}}
                    </view>
                </view>
                <block wx:if="{{orderInfo.state!=='user_canceled'&& orderInfo.state!=='system_credit_check_unpass_canceled'&&orderInfo.state!=='artificial_credit_check_unpass_canceled' &&orderInfo.state!=='merchant_relet_check_unpass_canceled'&&orderInfo.state!=='merchant_not_yet_send_canceled' && orderInfo.state!=='order_payment_overtime_canceled' && orderInfo.state!=='express_rejection_canceled'}}">
                    <view class="item">
                        <view class="left">
                            起租时间:
                        </view>
                        <view class="right">
                            {{orderLeaseInfo.leaseStartTime>0?filters.parseTime(orderLeaseInfo.leaseStartTime):'收到货后第二天开始计算'}}
                        </view>
                    </view>
                    <view class="item">
                        <view class="left">
                            到期时间:
                        </view>
                        <view class="right">
                            {{orderLeaseInfo.leaseExpireTime>0?filters.parseTime(orderLeaseInfo.leaseExpireTime):'按租期时间计算'}}
                        </view>
                    </view>
                    <block wx:if="{{orderInfo.state=='lease_finished'}}">
                        <view class="item">
                            <view class="left">
                                还机时间:
                            </view>
                            <view class="right">
                                {{filters.parseTime(orderInfo.backTime)}}
                            </view>
                        </view>
                    </block>

                    <view class="item">
                        <view class="left">
                            用户协议:
                        </view>
                        <view class="right xieyi" catchtap="toXieYi">
                            《用户租赁及服务协议》
                        </view>
                    </view>
                </block>
            </view>

            <!--支付租金/逾期金额/赔偿金额-->
            <block wx:if="{{orderInfo.state=='running_overdue'||orderInfo.state=='return_overdue' || (orderInfo.state=='running'&& !orderInfo.paid)||orderInfo.state=='pending_user_compensate'||(orderInfo.state=='pending_pay'&&orderLeaseInfo.deposit<=0)}}">
                <view class="pay-wp">
                    <view class="left">
                        <!--逾期显示期数-->
                        <block wx:if="{{orderInfo.state=='running_overdue'}}">
                            <view class="yuqi">
                                <text>待付租金(</text>
                                <text class="qishu">
                                    {{orderInfo.nextPayNum.length>1?orderInfo.nextPayNum:'0'+orderInfo.nextPayNum}}
                                </text>
                                <text>/{{orderLeaseInfo.payNum}}期)</text>
                            </view>
                        </block>

                        <view class="jinE">
                            <text class="unit">￥</text>
                            <text class="money">{{factualMoney}}</text>
                            <!--优惠信息 orderInfo.state=='running'|| 暂时不可以用优惠券-->
                            <block wx:if="{{orderInfo.state=='pending_pay' && youhuijine!='0.00'}}">
                                <text class="line">|</text>
                                <!--优惠券如果下单时候未选择 待支付时候可以继续选择  orderLeaseInfo.voucherDiscount 是下单时候已经使用的优惠 -->

                                <text class="youhui">
                                    已优惠:{{youhuijine}}
                                </text>

                            </block>
                            <!--逾期说明-->
                            <block wx:if="{{orderInfo.state=='running_overdue'||orderInfo.state=='return_overdue'}}">
                                <text class="iconfont icon-ico_doubt" catchtap="showNote"></text>
                            </block>
                        </view>

                    </view>
                    <!--按钮-->
                    <block wx:if="{{orderInfo.state=='return_overdue'}}">
                        <view class="right" catchtap="toPay">
                            逾期支付
                        </view>
                    </block>
                    <block wx:elif="{{orderInfo.state=='pending_compensate_check'}}">
                        <view class="right" catchtap="toPay">
                            赔偿支付
                        </view>
                    </block>
                    <block wx:else>
                        <view class="right" catchtap="toPay">
                            立即支付
                            <view class="des"
                                  wx:if="{{orderInfo.state=='running_overdue'||orderInfo.state=='running'}}">
                                {{orderInfo.state=='running_overdue'?'应':''}}还款日期：{{filters.parseTime(lastPayTime)}}
                            </view>
                        </view>
                    </block>

                </view>
            </block>
        </view>
    </scroll-view>

    <!--押金支付-->
    <block wx:if="{{orderInfo.state=='pending_pay'&&orderLeaseInfo.deposit>0}}">
        <view class="btn-wp" catchtap="depositOrderPay">
            <view class="btn">押金支付</view>
        </view>
    </block>
    <!--赔偿进度弹框-->
    <pop-up hideModal="{{hideCompensateModal}}" bindtrigger="disableScroll" position="top" id="compensate"
            loadingHide="{{loadingHide}}">
        <view class="compensateContent" slot="top">
            <view class="header">
                赔偿进度
            </view>
            <!--这里注意测试很多内容的时候-->
            <view class="schedule">
                <block wx:for="{{compensateS}}" wx:key="item.time">
                    <view class="rows">
                        <view class="t">
                            <view class="min">{{filters.parseTime(item.time,'h:m')}}</view>
                            <view class="day">{{filters.parseTime(item.time,'y-m-d')}}</view>
                        </view>
                        <view class="dot {{index==0?'current':''}}">
                        </view>
                        <view class="cont">{{item.content}}</view>
                    </view>
                </block>

            </view>
        </view>
    </pop-up>

    <!--礼券弹框-->
    <pop-up position="bottom" id="couponlist" bindtrigger="disableScroll">
        <view class="couponContent" slot="bottom">
            <view class="header">
                <view class="left">
                    优惠券
                </view>
                <view class="right" catchtap="useCoupon">
                    <text class="iconfont  {{!useCoupon?'icon-ico_select_pre':'icon-ico_select'}}"></text>
                    不使用优惠券
                </view>
            </view>
            <block wx:if="{{!couponList.length && !merchantcouponList.length}}">
                <view class="empty">
                    暂无可用优惠券~
                </view>
            </block>
            <block wx:else>
                <view class="commonList">
                    <!--蜜宝券-->
                    <block wx:if="{{couponList.length>0}}">
                        <block wx:for="{{couponList}}" wx:key="index">
                            <view class="coupon-wp">
                                <view class="blueCoupon coupon" catchtap="couponSelect"
                                      data-price="{{filters.parsePrice(item.price)}}" data-id="{{item.id}}">
                                    <!--标识 密券还是宝券-->
                                    <!--<view class="biaoshi">-->
                                    <!--<image class="img" src="../../../images/order/img-common@2x.png"></image>-->
                                    <!--</view>-->
                                    <view class="cnt">
                                        <view class="left">
                                            <view class="money">
                                                <text class="unit">￥</text>
                                                <text class="rent">{{item.price/100}}</text>
                                            </view>
                                            <view class="menkai">
                                                {{item.bonusModelMoneyOffRole=='-1'?'无门槛':'满'+filters.parsePrice(item.bonusModelMoneyOffRole)+'可用'}}
                                            </view>
                                        </view>

                                        <view class="right">
                                            <view class="t">
                                                <view class="title">{{item.bonusModelName}}</view>
                                                <view class="des">{{item.bonusModelNote}}</view>
                                            </view>
                                            <view class="b">
                                                <view class="line">限{{item.appliesGoodsTypeStr}}</view>
                                                <view class="line">{{item.effectiveTimeStr}}</view>
                                            </view>
                                        </view>
                                    </view>
                                </view>
                            </view>
                        </block>
                    </block>

                    <!--&lt;!&ndash;商家券&ndash;&gt;-->
                    <!--<block wx:if="{{merchantcouponList.length>0}}">-->
                    <!--<view class="merchantCouponDes">-->
                    <!--以下是商家优惠券-->
                    <!--</view>-->
                    <!--<block wx:for="{{merchantcouponList}}" wx:key="index">-->
                    <!--<view class="coupon-wp">-->
                    <!--<view class="merchantCoupon coupon" catchtap="couponSelect"-->
                    <!--data-price="{{filters.parsePrice(item.price)}}">-->
                    <!--<view class="biaoshi">-->
                    <!--<image class="img" src="../../../images/order/img-merchant@2x.png"></image>-->
                    <!--</view>-->
                    <!--<view class="cnt">-->
                    <!--<view class="left">-->
                    <!--<view class="money">-->
                    <!--<text class="unit">￥</text>-->
                    <!--<text class="rent">{{filters.parsePrice(item.price)}}</text>-->
                    <!--</view>-->
                    <!--<view class="menkai">{{item.type=='cash'?'无门槛':'满188可用'}}</view>-->
                    <!--</view>-->

                    <!--<view class="right">-->
                    <!--<view class="t">-->
                    <!--<view class="title">{{item.bonusModelName}}</view>-->
                    <!--<view class="des">{{item.bonusModelNote}}</view>-->
                    <!--</view>-->
                    <!--<view class="b">-->
                    <!--<view class="line">限{{item.appliesGoodsTypeStr}}</view>-->
                    <!--<view class="line">{{item.effectiveTimeStr}}</view>-->
                    <!--</view>-->
                    <!--</view>-->
                    <!--</view>-->
                    <!--</view>-->
                    <!--<view class="xianzhi">-->
                    <!--限【店铺名称】商家使用-->
                    <!--</view>-->
                    <!--</view>-->
                    <!--</block>-->
                    <!--</block>-->
                </view>
            </block>

        </view>
    </pop-up>

    <!--赔偿详情的弹框-->
    <pop-up position="bottom" bindtrigger="disableScroll" id="compensateDetail">
        <view class="compensateDetail" slot="bottom">
            <view class="header">
                <view class="left">
                    赔偿详情
                </view>
                <block wx:if="{{orderCompensateInfo.checkState=='init'}}">
                    <view class="right" catchtap="toSaveGuard">
                        赔偿申诉
                        <text class="iconfont icon-ico_right1"></text>
                    </view>
                </block>
                <block wx:else>
                    <view class="right" catchtap="showWhichCompensate">
                        查看{{showUserCompensate?'用户':'商户'}}举证
                        <text class="iconfont icon-ico_right1"></text>
                    </view>
                </block>
            </view>
            <view class="detail-wp">
                <view class="details {{showUserCompensate?'':'animate'}}">
                    <!--商户-->
                    <view class="compensate-pop-wp">
                        <block wx:if="{{orderCompensateInfo.image.length}}">
                            <view class="area1" >
                                <view class="pics">
                                    <view class="title">商户举证图片（共{{orderCompensateInfo.image.length}}张）</view>
                                    <scroll-view scroll-x>
                                        <view class="con">
                                            <block wx:for="{{orderCompensateInfo.image}}" wx:key="index">
                                                <view class="imgs-wp">
                                                    <image class="img" src="{{item.url}}" data-src="{{item.url}}"
                                                           bindtap="previewCompensateImage" mode='aspectFill'></image>
                                                </view>
                                            </block>
                                        </view>
                                    </scroll-view>
                                </view>
                            </view>
                        </block>

                        <view class="area2">
                            <view class="compensate-des-item" wx:for="{{orderCompensateInfo.damageSituation}}" wx:key="index">
                                <view class="reason">
                                    赔偿原因：{{item.describe}}
                                </view>
                                <view class="price">
                                    赔偿金额：
                                    <text>{{filters.parsePrice(item.money)}}元</text>
                                </view>
                            </view>
                        </view>
                    </view>
                    <!--用户-->
                    <view class="compensate-pop-wp">
                        <block wx:if="{{proof.image.length}}">
                            <view class="area1" >
                                <view class="pics">
                                    <view class="title">用户举证图片（共{{proof.image.length}}张）</view>
                                    <scroll-view scroll-x>
                                        <view class="con">
                                            <block wx:for="{{proof.image}}" wx:key="index">
                                                <view class="imgs-wp">
                                                    <image class="img" src="{{item.url}}" data-src="{{item.url}}"
                                                           bindtap="previewCompensateImage" mode='aspectFill'></image>
                                                </view>
                                            </block>
                                        </view>
                                    </scroll-view>
                                </view>
                            </view>
                        </block>

                        <view class="area2">
                            <view class="compensate-des-item">
                                <view class="reason">
                                    拒绝赔偿原因：{{proof.remark}}
                                </view>
                                <view class="reason">
                                    拒绝赔偿详细描述：{{proof.proofInfo}}
                                </view>
                            </view>
                        </view>
                    </view>
                </view>

            </view>

        </view>
    </pop-up>
    <!--租赁逾期说明-->

    <pop-up hideModal="{{overdueModal}}" bindtrigger="disableScroll" position="top" id="shuoming">
        <view class="running_overdueContent" slot="top">
            <view class="header">
                {{orderInfo.state=='running_overdue'?'租金逾期违约金计算公式:':'退还逾期违约金计算公式：'}}
            </view>
            <view class="content">
                <block wx:if="{{orderInfo.state=='running_overdue'}}">
                    <view>
                        1.租赁天数小于等于30天时
                        租金逾期违约金＝总租金＊5‰＊逾期天数
                    </view>
                    <view>
                        2.租赁天数>30天时
                        租金逾期违约金＝单期（30天）租金＊5‰＊逾期天数
                    </view>
                </block>
                <block wx:else>
                    <view>1.租赁天数小于等于30天时
                        退还逾期违约金＝单天租金＊逾期天数＋总租金＊5‰＊逾期天数
                    </view>
                    <view>
                        2.租赁天数>30天时
                        退还逾期违约金＝单天租金＊逾期天数＋单期（30天）租金＊5‰＊逾期天数
                    </view>
                </block>
                <view>
                    以上违约金不满t＋2不计
                </view>
            </view>
        </view>
    </pop-up>

    <!--押金支付确认弹框-->
    <pop-up hideModal="{{depositModal}}" bindtrigger="disableScroll" position="top" id="depositPayConfirm"
            closeHide="true">
        <view class="depositContent" slot="top">
            <view class='header'>押金支付</view>
            <view class="cont">
                当前订单正在进行免押审核，审核通过后，即可进行免押租赁，如果现在选择押金支付则会跳过免押审核，直接进行交押金租赁，并且一但选择交押支付后该订单不可以再进行免押审核，你是否确定交押金支付？
            </view>
            <view class="btn">
                <view class="think" catchtap="closeDepositModal">我再想想</view>
                <view class="payDeposit" catchtap="payDeposit">继续支付</view>
            </view>
        </view>
    </pop-up>

    <!--支付弹框-->
    <pop-up position="bottom" id="confirmPay" bindtrigger="disableScroll">
        <view class="confirmPay" slot="bottom">
            <view class="header">
                <view class="top">
                    <text class="iconfont icon-weixinzhifu"></text>
                    <text class="wxzf">微信支付</text>
                </view>
                <view class="content">
                    <view class="des">
                        实付金额
                    </view>
                    <view class="money">
                        <text class="unit">￥</text>
                        <text class="zhi">{{factualMoney}}</text>
                    </view>

                </view>
            </view>
            <!--付款方式 只有长租才支持选择一次性打折-->
            <block wx:if="{{orderInfo.longLease && orderInfo.nextPayNum==1 && payInfo.disposablePaymentEnabled}}">
                <view class="payMethod-wp">
                    <view class="payWay">付款方式:</view>
                    <!--分期-->
                    <view class="fukuai {{isSelectDisposablePayment?'':'active'}}" catchtap="choosePayRent"
                          data-way="false">
                        <view class="title">
                            分期支付
                            <text class="des">(首期应付租金)</text>
                        </view>
                        <view class="money">
                            <text class="unit">￥</text>
                            {{filters.parsePrice(payInfo.totalAmount)}}
                        </view>
                        <view class="icon">
                            <text class="iconfont {{isSelectDisposablePayment?'icon-ico_select':'icon-ico_select_pre'}}"></text>
                        </view>
                    </view>
                    <!--一次性-->
                    <view class="fukuai {{!isSelectDisposablePayment?'':'active'}}" catchtap="choosePayRent"
                          data-way="true">
                        <view class="title">
                            全款支付
                            <text class="des">(*支付优惠不支持意外保障)</text>
                        </view>
                        <view class="money">
                            <text class="unit">￥</text>
                            {{filters.parsePrice(orderLeaseInfo.totalAmount)}}
                            <block wx:if="{{payInfo.disposablePaymentDiscount}}">
                                <view class="discount">{{payInfo.disposablePaymentDiscount/10}}折</view>
                            </block>

                        </view>
                        <view class="icon">
                            <text class="iconfont {{!isSelectDisposablePayment?'icon-ico_select':'icon-ico_select_pre'}}"></text>
                        </view>

                    </view>
                </view>
            </block>

            <!--按钮-->
            <view class="submit">
                <button catchtap="confirmPay">确认支付</button>
            </view>
        </view>
    </pop-up>
</view>

























